from dotenv import load_dotenv
load_dotenv()

import os
from agents import Agent
from pydantic import BaseModel
from llm_utils import get_together_llm  
from agents import GuardrailFunctionOutput, Runner
class DentalScopeOutput(BaseModel):
    is_in_scope: bool
    reasoning: str

dental_guardrail_agent = Agent(
    name="Dental Scope Check",
    instructions="""
‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏ô `<task>`  
‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏à‡∏≤‡∏Å `<criteria>` ‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `<scope_schema>`, `<examples_in_scope>`, `<examples_out_of_scope>`, `<guideline>`, `<output_format>`, ‡πÅ‡∏•‡∏∞ `<examples>` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏ß‡πà‡∏≤  
"‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ tag ‡∏°‡∏µ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
- `<task>`: ‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠ ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö "‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£" ‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `is_in_scope=false`
- `<criteria>`: ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏î "‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°" ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà/‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï
- `<scope_schema>`: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏•‡∏±‡∏Å/‡∏¢‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï
- `<examples_in_scope>`/`<examples_out_of_scope>`: ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
- `<guideline>`: ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á reasoning ‡πÅ‡∏•‡∏∞‡∏Å‡∏é‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏£‡∏ß‡∏°‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏Å‡∏ß‡∏°)
- `<output_format>`: ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå **JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô** ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö
- `<examples>`: ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á input/output ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå

<criteria>
‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ "‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï" (is_in_scope=true) ‡πÄ‡∏°‡∏∑‡πà‡∏≠:
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ñ‡∏∂‡∏á‡∏ä‡πà‡∏ß‡∏á "‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°" ‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô ‡∏ú‡πà‡∏≤‡∏ü‡∏±‡∏ô‡∏Ñ‡∏∏‡∏î ‡∏≠‡∏∏‡∏î‡∏ü‡∏±‡∏ô ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏£‡∏≤‡∏Å‡∏ü‡∏±‡∏ô ‡∏Ç‡∏π‡∏î‡∏´‡∏¥‡∏ô‡∏õ‡∏π‡∏ô ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ü‡∏±‡∏ô ‡∏Ø‡∏•‡∏Ø
- ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏£/‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏±‡∏ß ‡∏¢‡∏≤/‡∏¢‡∏≤‡∏ä‡∏≤ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏£‡∏á/‡∏ö‡πâ‡∏ß‡∏ô‡∏õ‡∏≤‡∏Å ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≠‡∏î ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ ‡∏Ø‡∏•‡∏Ø ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£

‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ "‡∏ô‡∏≠‡∏Å‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï" (is_in_scope=false) ‡πÄ‡∏°‡∏∑‡πà‡∏≠:
- ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏•‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô ‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß)
- ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ä‡∏µ‡πâ‡∏ß‡πà‡∏≤ "‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£" (‡πÄ‡∏ä‡πà‡∏ô ‡∏ü‡∏±‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏≥‡πÑ‡∏á‡∏î‡∏µ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤)
- ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πÅ‡∏õ‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏£‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô "asdfgh", ‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)

‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏´‡∏≤‡∏Å "‡∏Å‡∏≥‡∏Å‡∏ß‡∏°" ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏¢‡∏∞‡∏ß‡πà‡∏≤‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏ü‡∏±‡∏ô)
‚Üí ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÄ‡∏õ‡πá‡∏ô is_in_scope=true ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô `reasoning` ‡∏ß‡πà‡∏≤ "‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô"
</criteria>

<task>
‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏±‡∏ô‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå
‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡πà‡∏≤ "‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà"
</task>

<context>
‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö **‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°**  
‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï ‡πÄ‡∏ä‡πà‡∏ô:
- ‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô
- ‡∏ú‡πà‡∏≤‡∏ü‡∏±‡∏ô‡∏Ñ‡∏∏‡∏î
- ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏ß‡∏î ‡πÅ‡∏ú‡∏• ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÑ‡∏´‡∏• ‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß
- ‡∏¢‡∏≤‡∏ä‡∏≤ ‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤
- ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£
- ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏£‡∏á‡∏ü‡∏±‡∏ô ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏ß‡∏ô‡∏õ‡∏≤‡∏Å ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≠‡∏î
- ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°
‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°:
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ü‡∏±‡∏ô
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ñ‡∏∂‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô noise ‡πÄ‡∏ä‡πà‡∏ô "123456", "asdfgh", ‡∏≠‡∏µ‡πÇ‡∏°‡∏à‡∏¥ ‡∏Ø‡∏•‡∏Ø
</context>

<scope_schema>
                     
<‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö (category_level_1)>
- "‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£"
- "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏ß‡∏∞‡πÅ‡∏ó‡∏£‡∏Å‡∏ã‡πâ‡∏≠‡∏ô"  
- "‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£"

<whitelist ‡∏´‡∏°‡∏ß‡∏î‡∏¢‡πà‡∏≠‡∏¢ (category_level_2) ‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏•‡∏±‡∏Å>
- ‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£:
    - "extraction"
    - "surgical removal of impacted teeth"
    - "dental implant surgery"
- ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏ß‡∏∞‡πÅ‡∏ó‡∏£‡∏Å‡∏ã‡πâ‡∏≠‡∏ô:
    - "Physical Symptoms"
    - "Digestive and Body Reactions"
    - "Wound and Infection"
    - "Respiratory and Throat"
- ‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£:
    - "all rounded post op instruction"
    - "sleeping"
    - "drinking straw"
    - "smoking"
    - "alcohol"
    - "workout"
    - "food"
    - "oral hygiene"
    - "compression"
    - "medicine"
- ‡πÉ‡∏ä‡πâ string ‡πÉ‡∏´‡πâ ‚Äú‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‚Äù ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏™‡πÅ‡∏•‡∏ä/‡∏™‡∏∞‡∏Å‡∏î‡∏ï‡πà‡∏≤‡∏á/‡πÄ‡∏Ñ‡∏™‡∏ï‡πà‡∏≤‡∏á
<category_level_2 definitions>
- extraction: ‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô
- surgical removal of impacted teeth: ‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏ô‡∏≥‡∏ü‡∏±‡∏ô‡∏Ñ‡∏∏‡∏î‡∏≠‡∏≠‡∏Å
- dental implant surgery: ‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏ù‡∏±‡∏á‡∏£‡∏≤‡∏Å‡πÄ‡∏ó‡∏µ‡∏¢‡∏°
- Physical Symptoms: ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û ‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏ß‡∏î ‡∏ö‡∏ß‡∏° ‡∏ä‡∏≤ ‡∏ï‡∏∂‡∏á
- Digestive and Body Reactions: ‡∏õ‡∏è‡∏¥‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö/‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏™‡πâ ‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏´‡∏±‡∏ß ‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏•‡∏µ‡∏¢
- Wound and Infection: ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ú‡∏•/‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏•/‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠
- Respiratory and Throat: ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏≠ ‡πÄ‡∏à‡πá‡∏ö‡∏Ñ‡∏≠ ‡πÄ‡∏™‡∏°‡∏´‡∏∞ ‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏•‡∏≥‡∏ö‡∏≤‡∏Å
- all rounded post op instruction: ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥
- sleeping: ‡∏ß‡∏¥‡∏ò‡∏µ/‡∏ó‡πà‡∏≤‡∏ô‡∏≠‡∏ô/‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏∏‡∏ô‡∏´‡∏°‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥
- drinking straw: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≠‡∏î‡∏î‡∏π‡∏î
- smoking: ‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà/‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
- alcohol: ‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå
- workout: ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢/‡∏¢‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡∏±‡∏Å
- food: ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£/‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£
- oral hygiene: ‡πÅ‡∏õ‡∏£‡∏á‡∏ü‡∏±‡∏ô ‡∏ö‡πâ‡∏ß‡∏ô‡∏õ‡∏≤‡∏Å ‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ö‡πâ‡∏ß‡∏ô‡∏õ‡∏≤‡∏Å
- compression: ‡∏Å‡∏±‡∏î‡∏ú‡πâ‡∏≤‡∏Å‡πä‡∏≠‡∏ã/‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Ñ‡∏ö‡∏Å‡∏î
- medicine: ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î/‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞/‡∏¢‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡πÜ

</scope_schema>

<examples_in_scope>
- ‡∏õ‡∏ß‡∏î‡∏´‡∏•‡∏±‡∏á‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô‡∏ó‡∏≥‡πÑ‡∏á‡∏î‡∏µ
- ‡πÅ‡∏ú‡∏•‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô‡∏´‡∏≤‡∏¢‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô
- ‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°
- ‡∏¢‡∏≤‡∏ä‡∏≤‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏≤‡∏ô‡∏Å‡∏µ‡πà‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
- ‡∏¢‡∏≤‡∏ä‡∏≤‡∏à‡∏∞‡∏´‡∏°‡∏î‡∏§‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà
</examples_in_scope>

<examples_out_of_scope>
- ‡∏ü‡∏±‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£
- ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- ‡∏à‡∏∞‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ
- ws;vgg?
- üôÉüôÉüôÉ
</examples_out_of_scope>

<guideline>
‡πÅ‡∏ô‡∏ß reasoning:
1) ‡∏™‡πÅ‡∏Å‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á "‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£" ‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô ‡∏ú‡πà‡∏≤‡∏ü‡∏±‡∏ô‡∏Ñ‡∏∏‡∏î ‡∏≠‡∏∏‡∏î‡∏ü‡∏±‡∏ô ‡∏¢‡∏≤‡∏ä‡∏≤ ‡∏õ‡∏ß‡∏î ‡πÅ‡∏ú‡∏• ‡πÄ‡∏•‡∏∑‡∏≠‡∏î ‡∏û‡∏ö‡∏ó‡∏±‡∏ô‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏Ø‡∏•‡∏Ø
2) ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó "‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥" ‡πÉ‡∏´‡πâ is_in_scope=true
3) ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏Å‡∏ß‡∏°‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô "‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏ü‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°") ‡πÉ‡∏´‡πâ is_in_scope=true ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°
4) ‡∏´‡∏≤‡∏Å‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πÅ‡∏õ‡∏°/‡πÑ‡∏£‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ ‡πÉ‡∏´‡πâ is_in_scope=false
<output_format>
‡∏à‡∏á‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô **JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô** ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ñ‡∏µ‡∏¢‡πå‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ (‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå‡∏≠‡∏∑‡πà‡∏ô):
{
  "is_in_scope": true | false,
  "reasoning": "‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏±‡πâ‡∏ô (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)"
}
‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î:
- ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ boolean ‡∏•‡πâ‡∏ß‡∏ô ‡πÜ: true/false (‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å)
- ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô/‡∏´‡∏•‡∏±‡∏á JSON
- ‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡∏õ‡∏µ‡∏Å‡∏Å‡∏≤‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢
</output_format>

<examples>
Q: "‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏ü‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏°‡∏±‡πâ‡∏¢"
A:
{"is_in_scope": true, "reasoning": "‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏±‡∏ß (workout) ‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏ü‡∏±‡∏ô ‡∏à‡∏±‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï"}

Q: "‡∏ü‡∏±‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£"
A:
{"is_in_scope": false, "reasoning": "‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£"}

Q: "‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°"
A:
{"is_in_scope": true, "reasoning": "‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡∏•‡∏≠‡∏î‡∏´‡∏•‡∏±‡∏á‡∏ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô ‡∏à‡∏±‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï"}

Q: "ws;vgg?"
A:
{"is_in_scope": false, "reasoning": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏£‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢"}

Q: "‡∏ú‡πà‡∏≤‡∏ü‡∏±‡∏ô‡∏Ñ‡∏∏‡∏î‡∏°‡∏≤ 24 ‡∏ä‡∏°. ‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏ö‡∏≤ ‡πÜ ‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á"
A:
{"is_in_scope": true, "reasoning": "‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ü‡∏±‡∏ô‡∏Ñ‡∏∏‡∏î (workout) ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï"}
</examples>

‡∏Ç‡πâ‡∏≠‡∏´‡πâ‡∏≤‡∏°:
- ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏î‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ñ‡∏∂‡∏á "‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£" ‡πÄ‡∏•‡∏¢‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥ ‚Üí is_in_scope=false
</guideline>
                
‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥:
1. ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
2. ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `<criteria>`, `<scope_schema>`, `<guideline>` ‡πÅ‡∏•‡∏∞ `<examples>` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤
3. ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ JSON ‡∏ï‡∏≤‡∏° `<output_format>` ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏î‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
""",
    output_type=DentalScopeOutput,
    model="gpt-4o"
)

async def run_dental_guardrail_check(input_data: str) -> GuardrailFunctionOutput:
    result = await Runner.run(dental_guardrail_agent, input_data)
    try:
        final_output = result.final_output_as(dental_guardrail_agent.output_type)
        is_in_scope = bool(final_output.is_in_scope)
    except Exception:

        return GuardrailFunctionOutput(
            output_info={"reasoning": "parse_failed; fallback=uncertain"},
            tripwire_triggered=False  # fail-open ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏Ç‡∏±‡πâ‡∏ô clarify/check ‡∏ï‡πà‡∏≠
        )

    tripwire = not is_in_scope
    return GuardrailFunctionOutput(
        output_info={"reasoning": final_output.reasoning},
        tripwire_triggered=tripwire
    )

